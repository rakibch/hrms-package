"use strict";/*!
 * @he-tree/vue v2.9.3
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://hetree.phphe.com/
 * Released under the MIT License.
 */Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const _=require("vue-demi"),de=require("helper-js"),ve=require("@virtual-list/vue/vue2"),G=require("@he-tree/tree-utils"),F=require("@he-tree/dnd-utils");function ye(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const r in e)if(r!=="default"){const i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>e[r]})}}return t.default=e,Object.freeze(t)}const f=ye(de);let K=!1;const be=()=>{K=!0,setTimeout(()=>{K=!1},100)},me=_.defineComponent({props:["stat","rtl","btt","indent","table","treeLine","treeLineOffset","processor"],emits:["open","close","check"],setup(e,{emit:t}){const r=_.computed(()=>({[e.rtl?"paddingRight":"paddingLeft"]:e.indent*(e.stat.level-1)+"px"}));_.watch(()=>e.stat.checked,b=>{K||e.processor.afterOneCheckChanged(e.stat)&&t("check",e.stat)}),_.watch(()=>e.stat.open,b=>{K||(t(b?"open":"close",e.stat),be())});const i=_.computed(()=>{const b=[],y=s=>{var c;if(s.parent){let d=(c=s.parent)==null?void 0:c.children.indexOf(s);do{d++;let h=s.parent.children[d];if(h){if(!h.hidden)return!0}else break}while(!0)}return!1},m=e.rtl?"right":"left",x=e.btt?"top":"bottom";let l=e.stat;for(;l;){let s=(l.level-2)*e.indent+e.treeLineOffset;const c=y(l),d=()=>{b.push({style:{[m]:s+"px",[x]:c?0:"50%"}})};l===e.stat?l.level>1&&d():c&&d(),l=l.parent}return b}),o=_.computed(()=>{let b=(e.stat.level-2)*e.indent+e.treeLineOffset;return{[e.rtl?"right":"left"]:b+"px"}});return{indentStyle:r,vLines:i,hLineStyle:o}}});var De=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.table?r("tr",{ref:"el",staticClass:"tree-node"},[e._t("default",null,{indentStyle:e.indentStyle})],2):r("div",{ref:"el",staticClass:"tree-node",class:{"tree-node--with-tree-line":e.treeLine},style:e.indentStyle},[e.treeLine?[e._l(e.vLines,function(i){return r("div",{staticClass:"tree-line tree-vline",style:i.style})}),e.stat.level>1?r("div",{staticClass:"tree-line tree-hline",style:e.hLineStyle}):e._e()]:e._e(),r("div",{staticClass:"tree-node-inner"},[e._t("default",null,{indentStyle:e.indentStyle})],2)],2)},xe=[];function Z(e,t,r,i,o,b,y,m){var x=typeof e=="function"?e.options:e;t&&(x.render=t,x.staticRenderFns=r,x._compiled=!0);var l;if(o&&(l=o),l)if(x.functional){x._injectStyles=l;var s=x.render;x.render=function(h,v){return l.call(v),s(h,v)}}else{var c=x.beforeCreate;x.beforeCreate=c?[].concat(c,l):[l]}return{exports:e,options:x}}const le={};var _e=Z(me,De,xe,!1,Ce);function Ce(e){for(let t in le)this[t]=le[t]}const ce=function(){return _e.exports}();function Se(e,t={}){const r={...t,statHandler(i){return this._statHandler2&&(i=this._statHandler2(i)),z(t.statHandler,_.reactive(i))},statsHandler(i){return z(t.statsHandler,_.reactive(i))},statsFlatHandler(i){return z(t.statsFlatHandler,_.reactive(i))}};return G.makeTreeProcessor(e,r)}function z(e,t){return e?e(t):t}const Oe=_.defineComponent({components:{VirtualList:ve,TreeNode:ce},props:{value:{required:_.isVue2,type:Array},modelValue:{required:_.isVue3,type:Array},updateBehavior:{type:String,default:"modify"},processor:{type:Object,default:()=>Se([],{noInitialization:!0})},childrenKey:{type:String,default:"children"},textKey:{type:String,default:"text"},indent:{type:Number,default:20},virtualization:{type:Boolean,default:!1},virtualizationPrerenderCount:{type:Number,default:20},defaultOpen:{type:Boolean,default:!0},statHandler:{type:Function},rtl:{type:Boolean,default:!1},btt:{type:Boolean,default:!1},table:{type:Boolean,default:!1},watermark:{type:Boolean,default:!1},nodeKey:{type:[String,Function],default:"index"},treeLine:{type:Boolean,default:!1},treeLineOffset:{type:Number,default:8}},emits:["update:modelValue","click:node","open:node","close:node","check:node","beforeDragStart","before-drag-start","after-drop","change","enter","leave"],data(){return{stats:[],statsFlat:[],dragNode:null,dragOvering:!1,placeholderData:{},placeholderColspan:1,batchUpdateWaiting:!1,self:this,_ignoreValueChangeOnce:!1}},computed:{valueComputed(){return(_.isVue2?this.value:this.modelValue)||[]},visibleStats(){const{statsFlat:e,isVisible:t}=this;let r=e;return this.btt&&(r=r.slice(),r.reverse()),r.filter(i=>t(i))},rootChildren(){return this.stats}},methods:{_emitValue(e){this.$emit(_.isVue2?"input":"update:modelValue",e)},_updateValue(e){return this.updateBehavior==="disabled"?!1:(e!==this.valueComputed&&(this._ignoreValueChangeOnce=!0),this._emitValue(e),!0)},getStat:X(w("getStat")),has:X(w("has")),updateCheck:w("updateCheck"),getChecked:w("getChecked"),getUnchecked:w("getUnchecked"),openAll:w("openAll"),closeAll:w("closeAll"),openNodeAndParents:w("openNodeAndParents"),isVisible:w("isVisible"),move:ie("move"),add:X(ie("add")),addMulti(e,t,r){this.batchUpdate(()=>{let i=r;for(const o of e)this.add(o,t,i),i!=null&&i++})},remove:w("remove"),removeMulti(e){let t=[...e];this.batchUpdate(()=>{for(const r of t)this.remove(r)})},iterateParent:w("iterateParent"),getSiblings:w("getSiblings"),getData:w("getData"),getRootEl(){return this.$refs.vtlist.listElRef},batchUpdate(e){const t=this.ignoreUpdate(e);return this.batchUpdateWaiting||this._updateValue(this.updateBehavior==="new"?this.getData():this.valueComputed),t},ignoreUpdate(e){const t=this.batchUpdateWaiting;this.batchUpdateWaiting=!0;const r=e();return this.batchUpdateWaiting=t,r}},watch:{processor:{immediate:!0,handler(e){if(e){const t=r=>{if(r){const{childrenKey:i}=this;return r[i]||(r[i]=[]),r[i]}else return this.valueComputed};e._statHandler2=this.statHandler?r=>r.data===this.placeholderData?r:this.statHandler(r):null,e.afterSetStat=(r,i,o)=>{const{childrenKey:b,updateBehavior:y}=this;let m=this.valueComputed;if(y==="new"){if(this.batchUpdateWaiting)return;m=this.getData()}else if(y==="modify"){const x=t(i==null?void 0:i.data);x.includes(r.data)||x.splice(o,0,r.data)}this.batchUpdateWaiting||this._updateValue(m)},e.afterRemoveStat=r=>{var y;const{childrenKey:i,updateBehavior:o}=this;let b=this.valueComputed;if(o==="new"){if(this.batchUpdateWaiting)return;b=this.getData()}else if(o==="modify"){const m=t((y=r.parent)==null?void 0:y.data);f.arrayRemove(m,r.data)}this.batchUpdateWaiting||this._updateValue(b)}}e.initialized||(e.data=this.valueComputed,Object.assign(e,f.objectOnly(this,["childrenKey","defaultOpen"])),e.init(),e.updateCheck()),this.stats=e.stats,this.statsFlat=e.statsFlat,e.data!==this.valueComputed&&this._updateValue(e.data)}},valueComputed:{handler(e){if(this.dragOvering||this.dragNode||this._ignoreValueChangeOnce)this._ignoreValueChangeOnce=!1;else{const{processor:r}=this;r.data=e,r.init(),this.stats=r.stats,this.statsFlat=r.statsFlat}}}},created(){},mounted(){typeof window<"u"&&(this.watermark===!1&&(window._heTreeWatermarkDisabled=!0),this.watermark&&!window._heTreeWatermarkDisabled&&(window._heTreeWatermark||(window._heTreeWatermark=!0,console.log("%c[he-tree] Vue tree component:  https://hetree.phphe.com","color:#0075ff; font-size:14px;"))))}});function w(e){return function(...t){return this.processor[e](...t)}}function ie(e){return function(...t){return this.batchUpdate(()=>this.processor[e](...t))}}function X(e){return function(t,...r){return t&&(t=_.reactive(t)),e.call(this,t,...r)}}var we=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("VirtualList",{ref:"vtlist",staticClass:"he-tree",class:{"he-tree--rtl rtl":e.rtl,"he-tree--drag-overing drag-overing":e.dragOvering},attrs:{items:e.visibleStats,disabled:!e.virtualization,table:e.table,itemKey:e.nodeKey},scopedSlots:e._u([{key:"prepend",fn:function(){return[e._t("prepend",null,{tree:e.self})]},proxy:!0},{key:"default",fn:function(i){var o=i.item,b=i.index;return[r("TreeNode",{class:[o.class,{"drag-placeholder-wrapper":o.data===e.placeholderData,"dragging-node":o===e.dragNode}],style:o.style,attrs:{"vt-index":b,stat:o,rtl:e.rtl,btt:e.btt,indent:e.indent,table:e.table,treeLine:e.treeLine,treeLineOffset:e.treeLineOffset,processor:e.processor},on:{click:function(y){return e.$emit("click:node",o)},open:function(y){return e.$emit("open:node",y)},close:function(y){return e.$emit("close:node",y)},check:function(y){return e.$emit("check:node",y)}},scopedSlots:e._u([{key:"default",fn:function(y){var m=y.indentStyle;return[o.data===e.placeholderData?[e.table?r("td",{style:m,attrs:{colspan:e.placeholderColspan}},[r("div",{staticClass:"drag-placeholder he-tree-drag-placeholder"},[e._t("placeholder",null,{tree:e.self})],2)]):r("div",{staticClass:"drag-placeholder he-tree-drag-placeholder"},[e._t("placeholder",null,{tree:e.self})],2)]:e._t("default",function(){return[e._v(e._s(o.data[e.textKey])+" ")]},{node:o.data,stat:o,indentStyle:m,tree:e.self})]}}],null,!0)})]}},{key:"append",fn:function(){return[e._t("append",null,{tree:e.self})]},proxy:!0}],null,!0)})},Ne=[];const oe={};var ke=Z(Oe,we,Ne,!1,Le);function Le(e){for(let t in oe)this[t]=oe[t]}const ue=function(){return ke.exports}();let a=null,n=null,A,H,R,j,Y,S,J;const fe={get startInfo(){return A},get targetInfo(){return H},get dragNode(){return S},get startTree(){return a},get targetTree(){return n},get closestNode(){return J}},he=_.defineComponent({extends:ue,props:{triggerClass:{type:[String,Array]},disableDrag:Boolean,disableDrop:Boolean,eachDraggable:{type:Function},eachDroppable:{type:Function},rootDroppable:{type:[Boolean,Function],default:!0},dragOpen:{type:Boolean,default:!0},dragOpenDelay:{type:Number,default:0},beforeDragOpen:{type:Function},resolveStartMovePoint:{type:[String,Function]},keepPlaceholder:{type:Boolean},maxLevel:{type:Number},dragCopy:{type:Boolean},dragCopyDataHandler:{type:Function},onExternalDragOver:{type:Function},externalDataHandler:{type:Function},ondragstart:{type:Function}},data(){return{treeDraggableInstance:null}},computed:{},methods:{getNodeByElement(e){const t=e.getAttribute("vt-index");return t==null?null:this.visibleStats[t]},isDraggable(e){if(this.disableDrag)return!1;if(e.draggable!=null)return e.draggable;if(this.eachDraggable){const r=this.eachDraggable(e);if(r!=null)return r}const{parent:t}=e;return t?this.isDraggable(t):!0},isDroppable(e){if(this.disableDrop)return!1;if(!e)return f.resolveValueOrGettter(this.rootDroppable,[this,a]);if(e.droppable!=null)return e.droppable;if(this.eachDroppable){const r=this.eachDroppable(e);if(r!=null)return r}const{parent:t}=e;return t?this.isDroppable(t):!0},_eachDroppable(){var e;return f.resolveValueOrGettter((e=this._isDragCopy)==null?void 0:e.call(this),[this])}},mounted(){const e=(l,s)=>{let c=!0;return a&&a!==this&&(c=c&&this._isMoved),this.table&&!this._isDragCopy&&(c=c&&this._isDragCopy),c&&(l.x!==s.x||l.y!==s.y)},t=(l,s)=>{n.ignoreUpdate(()=>{if(!n.has(n.placeholderData)){if(n.table){let d=0;const h=n.getRootEl().querySelector("tr");if(h)for(const{value:v}of f.iterateAll(h.children))f.css(v,"display")!=="none"&&(d+=v.colSpan||1);d<1&&(d=1),n.placeholderColspan=d}n.add(n.placeholderData)}const c=n.getStat(n.placeholderData);n.move(c,l,s)})},r=()=>{const l=this;if(l.has(l.placeholderData))return l.remove(l.getStat(l.placeholderData)),!0},i=l=>{l?F.context.dropEffect=a!=null&&a.dragCopy?"copy":"move":F.context.dropEffect="none"},o=l=>{const s=this;l?i(!0):s.keepPlaceholder?s.has(s.placeholderData)||i(!1):(r(),i(!1))};let b={x:0,y:0};const y=this.getRootEl();let m=null;const x=()=>{n!=null&&n.has(n.placeholderData)&&n.ignoreUpdate(()=>{n.remove(n.getStat(n.placeholderData)),a&&(a.dragNode.hidden=!1,a.dragOvering=!1)})};this.treeDraggableInstance=F.extendedDND(y,{beforeDragStart:l=>{if(!F.context.triggerElement)return;let s=this.triggerClass;(!s||s.length===0)&&(s="tree-node");let c=f.toArrayIfNot(s),d=f.findParent(F.context.triggerElement,h=>{if(f.hasClassIn(h,c))return!0;if(f.hasClass(h,"tree-node"))return"break"},{withSelf:!0,until:y});if(m=f.findParent(d,h=>{if(f.hasClass(h,"tree-node"))return!0},{withSelf:!0,until:y}),!!m){if(S=this.getNodeByElement(m),!S)throw"Can't find drag node";if(this.isDraggable(S))return this.$emit("before-drag-start",S),this.$emit("beforeDragStart",S),y}},onDragStart:l=>{var h,v,u;if(!m||!S)return;{const{x:g,y:N}=m.getBoundingClientRect(),{clientX:D,clientY:P}=l;(h=l.dataTransfer)==null||h.setDragImage(m,D-g,P-N)}Y={x:l.clientX,y:l.clientY},a=this,a.dragNode=S,j=(()=>{if(this.resolveStartMovePoint==="mouse")return{x:l.clientX,y:l.clientY};if(typeof this.resolveStartMovePoint=="function")return this.resolveStartMovePoint(m);{let g,N=0;if(this.table){let D=m.getBoundingClientRect();g={x:D.x,y:D.y},this.rtl&&(g.x=D.right),N=D.height}else if(!this.rtl)g=m.children[0].getBoundingClientRect().toJSON(),N=g.height;else{const D=m.children[0].getBoundingClientRect();g={x:D.right,y:D.y},N=D.height}return this.btt&&(g.y+=N),g}})(),this.dragOvering=!0;const c=a.getSiblings(a.dragNode),d=c.indexOf(S);A={tree:a,dragNode:S,parent:S.parent,siblings:c,indexBeforeDrop:d},n=this,(v=l.dataTransfer)==null||v.setData("text",`he-tree drag start at ${new Date().toISOString()}`),a._eachDroppable()||setTimeout(()=>{S.hidden=!0,t(S.parent,d+1)},0),(u=this.ondragstart)==null||u.call(this,l)},onEnter:l=>{this.$emit("enter",l)},onLeave:l=>{R=null,this.dragOvering=!1,F.context.preventDefault=!1,r(),this.$emit("leave",l)},onDragOver:f.applyFinally(l=>{if(!a){if(!this.onExternalDragOver||this.onExternalDragOver(l)===!1)return;F.context.preventDefault=!0}const s={x:l.clientX,y:l.clientY},c=e(s,b);if(b=s,!c)return;this.dragOvering=!0,n=this;const d=j?{x:j.x+(s.x-Y.x),y:j.y+(s.y-Y.y)}:{...s},{btt:h,rtl:v}=n;if(n.disableDrop){F.context.dropEffect="none";return}let u,g;const N=n.getRootEl().querySelectorAll(".tree-node"),D=[];N.forEach(p=>{!f.hasClassIn(p,["drag-placeholder-wrapper","dragging-node"])&&f.css(p,"display")!=="none"&&D.push(p)});const P=f.binarySearch(D,p=>f.getBoundingClientRect(p)[h?"bottom":"top"]-d.y,{returnNearestIfNoHit:!0});let C=null,I,q;P.hit||(P.greater?h||(C=P.index-1,D[C]||C++):h&&(C=P.index+1,D[C]||C--)),C==null&&(C=P.index),I=D[C],q=h?D[C-1]:D[C+1],u=I&&n.getNodeByElement(I),g=q&&n.getNodeByElement(q);const{indent:W}=n,L=f.cacheFunction(()=>{if(n.table){let p=f.getBoundingClientRect(I).toJSON();const k=W*(u.level-1);return v?(p.width-=k,p.right-=k):p.x+=k,p}else return f.getBoundingClientRect(I.firstElementChild)}).action,Q=f.cacheFunction(()=>h?d.y>L().y+L().height/2:d.y<L().y+L().height/2).action,pe=f.cacheFunction(()=>h?!I||C===D.length-1&&Q():!I||C===0&&Q()).action,ee=f.cacheFunction(()=>v?d.x-(L().x+L().width):L().x-d.x).action,ge=f.cacheFunction(()=>v?d.x<L().x+L().width-W:d.x>L().x+W).action;let E;if(pe())E=1,u=null;else if(u)ee()>0?E=u.level-Math.ceil(ee()/W):ge()?E=u.level+1:E=u.level;else return;g&&E<g.level&&(E=g.level),(async()=>{let p,k,$=!1,V=null;const U=async O=>{if(O.open)return!0;if(n.dragOpen)if(n.dragOpenDelay)if(V=O,R===O)$=!0;else{let B=f.promisePin();R=O;const M=O;return setTimeout(async()=>{M!==R?($=!0,B.resolve(!0)):(n.beforeDragOpen&&await n.beforeDragOpen(O),M!==R?($=!0,B.resolve(!0)):(O.open=!0,V=null,B.resolve(!0)))},n.dragOpenDelay),await B.promise}else return n.beforeDragOpen&&await n.beforeDragOpen(O),O.open=!0,!0;else return!1},T=async()=>{if(n.isDroppable(u)&&await U(u)){if($)return;p=u,k=null}else return!1},te=(O=E)=>{let B=u,M=[];for(;B&&B.level>=O;)B=B.parent||null,M.unshift(B);let ne=0;for(const ae of M){if(n.isDroppable(ae))return p=ae,k=M[ne+1]||u,!0;ne++}return!1};J=u||null,u?E>u.level?await T()===!1&&te(u.level):te()===!1&&await T():n.isDroppable(null)&&(p=null),R=V;const re=!!(!$&&(p||p===null));return{cancelled:$,success:re,parent:p,index:re?k?(p?p.children:n.stats).filter(O=>O.data!==n.placeholderData).indexOf(k)+1:0:-1}})().then(p=>{if(!p.cancelled){if(!p.success){o(!1);return}if(n.maxLevel!=null&&n.maxLevel>0){let k=1;if(a){const V=a.dragNode;let U=0;f.walkTreeData(V,T=>{T.level>U&&(U=T.level)},{childrenKey:G.CHILDREN}),k=U-V.level+1}if(k+(p.parent?p.parent.level:0)>n.maxLevel){o(!1);return}}o(!0),t(p.parent,p.index)}})},()=>{}),onDrop:l=>{n=this;const s=!a;if(!n)return;const c=a==null?void 0:a.dragNode;let d,h=(()=>{var u;let v=!0;if(!n.has(n.placeholderData))v=!1;else if(s)d=(u=this.externalDataHandler)==null?void 0:u.call(this,l),v=d!=null;else if(!a.dragCopy){const g=n.getStat(n.placeholderData);a===n&&g.parent===c.parent&&(f.findTreeData(c,N=>N===g),G.CHILDREN)}return v})();if(h){const v=n.getStat(n.placeholderData),u=n.getSiblings(v);H={tree:n,dragNode:c,parent:v.parent,siblings:u,indexBeforeDrop:u.indexOf(v)}}(()=>{if(x(),h){let v=H.indexBeforeDrop;a&&!a.dragCopy&&a===n&&A.parent==H.parent&&A.indexBeforeDrop<v&&v--,a&&a!==n&&!a._eachDroppable()&&a.batchUpdate(()=>{a.remove(c),a.updateCheck()}),n.batchUpdate(()=>{let u=a==null?void 0:a.dragNode,g;d?g=d:a._eachDroppable()&&(g=f.cloneTreeData(a.dragNode.data,{childrenKey:a.childrenKey}),a.dragCopyDataHandler&&(g=a.dragCopyDataHandler(g))),g&&(n.add(g),u=n.getStat(g)),n.move(u,H.parent,v),n.updateCheck()})}n.$emit("after-drop"),h&&(a&&(a.dragCopy||a.$emit("change")),n!==a&&n.$emit("change"))})()},onDragEnd:l=>{x(),a&&(a.dragNode&&(a.dragNode.hidden=!1),a.dragNode=null,a.dragOvering=!1,a=null),n=null,R=null,S=null,J=null}})},unmounted(){var e;(e=this.treeDraggableInstance)==null||e.destroy()}}),Be=_.defineComponent({props:{open:{type:Boolean}}});var Pe=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a",{staticClass:"he-tree__open-icon",class:{open:e.open}},[r("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"}},[r("title",[e._v("chevron-right")]),r("path",{attrs:{d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"}})])])},Ee=[];const se={};var Fe=Z(Be,Pe,Ee,!1,Ie);function Ie(e){for(let t in se)this[t]=se[t]}const $e=function(){return Fe.exports}();function Re(e,t){try{return{mixins:[he],created:new Function(Ve(e,t))()}}catch{throw new Error("he-tree-pro: wrong secret key")}}function Ve(e,t){e=encodeURIComponent(e),e.length%2===1&&(e+="h"),e=e.split("").reverse().join(""),t=atob(t);for(let r=0;r<e.length;r+=2){const i=e[r],o=e[r+1];t=Me(t,i,o)}return Ue("arb=inowc=ocmet;etrnfucton){are=1,=tistr{evod !=b}ath(){e&(c_htreWtemak=)=e,._sMve=(=>._eteeatrmrkd.israCoy=)=d.abe,._acDrppbl=(=>.dagop)}",t)}function Me(e,t,r){let i="";for(let o=0;o<e.length;o++){const b=e[o];b===t?i+=r:b===r?i+=t:i+=b}return i}function Ue(e,t){let r=0,i="";for(;;){let o;if(o=r,o>=t.length||(i+=t[o],o=r*2,o>=e.length)||(i+=e[o],o+=1,o>=e.length))break;i+=e[o],r++}return i}Object.defineProperty(exports,"walkTreeData",{enumerable:!0,get:()=>de.walkTreeData});exports.BaseTree=ue;exports.Draggable=he;exports.OpenIcon=$e;exports.TreeNode=ce;exports.context=fe;exports.dragContext=fe;exports.pro=Re;

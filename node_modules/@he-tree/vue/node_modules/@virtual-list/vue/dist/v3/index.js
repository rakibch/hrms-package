"use strict";/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const o=require("vue-demi"),Q=require("helper-js"),r=require("vue");function U(e){const a=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const s in e)if(s!=="default"){const u=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(a,s,u.get?u:{enumerable:!0,get:()=>e[s]})}}return a.default=e,Object.freeze(a)}const S=U(Q),X=o.defineComponent({props:{table:Boolean}}),j=(e,a)=>{const s=e.__vccOpts||e;for(const[u,b]of a)s[u]=b;return s},Y={key:0},Z={key:1};function ee(e,a,s,u,b,z){return e.table?(r.openBlock(),r.createElementBlock("table",Y,[r.renderSlot(e.$slots,"prepend"),r.createElementVNode("tbody",null,[r.renderSlot(e.$slots,"default")]),r.renderSlot(e.$slots,"append")])):(r.openBlock(),r.createElementBlock("div",Z,[r.renderSlot(e.$slots,"prepend"),r.renderSlot(e.$slots,"default"),r.renderSlot(e.$slots,"append")]))}const te=j(X,[["render",ee]]),ne=o.defineComponent({components:{VirtualListTable:te},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const a=o.ref(0),s=o.ref(e.firstRender-1),u=o.computed(()=>{var t;return S.notGreaterThan(s.value,(((t=e.items)==null?void 0:t.length)||1)-1)}),b=o.ref(0),z=o.computed(()=>m.value[a.value]?L(a.value):0),F=o.computed(()=>m.value.length>0?L(m.value.length-1)+S.arrayLast(B.value):0),c=o.computed(()=>m.value[u.value]?F.value-L(u.value)-B.value[u.value]:0),v=o.computed(()=>e.disabled?{}:{overflow:"auto"}),V=o.computed(()=>{const t={display:"flex"};return e.disabled||(e.horizontal?Object.assign(t,{"margin-left":z.value+"px","margin-right":c.value+"px",width:F.value-c.value-z.value+"px"}):Object.assign(t,{"margin-top":z.value+"px","margin-bottom":c.value+"px"})),t["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete t.display,delete t["flex-direction"]),t}),k=o.computed(()=>o.reactive((e.items||[]).map(()=>null))),B=o.computed(()=>(e.items||[]).map((t,n)=>{var g;if(k[n]!=null)return k[n];let l=(g=e.itemSize)==null?void 0:g.call(e,t,n);return l==null&&(l=b.value),l})),m=o.computed(()=>{const t=[];return B.value.reduce((n,l)=>(t.push(n),n+l),0),t});o.watch(()=>e.items,y);const q=o.computed(()=>{if(!e.items||e.disabled)return;const t=[];for(let n=a.value;n<=u.value;n++){const l=e.items[n];if(!l)break;t.push({item:l,index:n})}return t}),I=o.ref(),N=o.ref();o.onMounted(async()=>{y();try{D()}catch{await o.nextTick(),y()}});let C;function A(){const t=I.value;if(!t)return;const n=E(t);C!=null&&e.buffer-Math.abs(n-C)>=10||(C=n,y())}let O=!1,T=!1;async function y(){var W;if(O){T=!0;return}if(!e.items||e.disabled)return;O=!0;const t=I.value,n=(W=N.value)==null?void 0:W.$el;if(!t||!n)return;b.value||(b.value=_()),a.value=H(),s.value=G(),await o.nextTick();let l,g=0;const $={},P=e.table?n.querySelector("tbody").children:n.children;for(let d=0;d<P.length;d++){const i=P[d],f=S.css(i,"position");if(f&&["absolute","fixed"].includes(f))continue;const h=S.css(i,"display")!=="none"?K(i):0,p=i.getAttribute("vt-index"),w=p?parseInt(p):a.value+g;$[w]=($[w]||0)+h,g++}for(const d of Object.keys($)){const i=parseInt(d);k.value[i]!==$[i]&&(k.value[i]=$[i],l=!0)}l&&await o.nextTick(),O=!1,T&&(T=!1,y());function H(){const d=E(t)-x(t)-e.buffer;return S.binarySearch(m.value,f=>f-d,{returnNearestIfNoHit:!0}).index}function G(){const d=E(t)-x(t)+R(t)+e.buffer;return S.binarySearch(m.value,f=>f-d,{returnNearestIfNoHit:!0}).index}function _(){const i=[],f=e.table?n.querySelector("tbody").children:n.children;for(let h=0;h<f.length;h++){const p=f[h],w=getComputedStyle(p);if(["absolute","fixed"].includes(w.position))continue;const J=K(p);if(i.push(J),i.length>=10)break}return i.length===0?0:i.reduce((h,p)=>h+p,0)/i.length}}function R(t){const n=getComputedStyle(t);let l=parseFloat(e.horizontal?n.width:n.height);return n.boxSizing==="border-box"&&(e.horizontal?l=l-parseFloat(n.borderLeftWidth)-parseFloat(n.borderRightWidth):l=l-parseFloat(n.borderTopWidth)-parseFloat(n.borderBottomWidth)),l}function K(t){let n=R(t);const l=getComputedStyle(t);return e.horizontal?n+=parseFloat(l.borderLeftWidth)+parseFloat(l.borderRightWidth)+parseFloat(l.marginLeft)+parseFloat(l.marginRight):n+=parseFloat(l.borderTopWidth)+parseFloat(l.borderBottomWidth)+parseFloat(l.marginTop)+parseFloat(l.marginBottom),n=Number.isNaN(n)?0:n,n}function E(t){return e.horizontal?t.scrollLeft:t.scrollTop}function x(t){const n=getComputedStyle(t);return e.horizontal?parseFloat(n.paddingLeft):parseFloat(n.paddingTop)}function L(t){return m.value[t]}function D(){const t=I.value;new ResizeObserver(l=>{for(let g of l)if(S.hasClass(g.target,"vtlist")){y();break}}).observe(t)}function M(t,n){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return n;if(typeof e.itemKey=="function")return e.itemKey(t,n)}}return{listElRef:I,listInnerRef:N,onscroll:A,listStyle:v,listInnerStyle:V,visibleItemsInfo:q,getItemKey:M,update:y,sizes:B,positions:m,runtimeSizes:k}}});function re(e,a,s,u,b,z){const F=r.resolveComponent("VirtualListTable");return r.openBlock(),r.createElementBlock("div",{class:"vtlist",ref:"listElRef",style:r.normalizeStyle(e.listStyle),onScrollPassive:a[0]||(a[0]=(...c)=>e.onscroll&&e.onscroll(...c))},[r.createVNode(F,{class:"vtlist-inner",ref:"listInnerRef",style:r.normalizeStyle(e.listInnerStyle),table:e.table},{prepend:r.withCtx(()=>[r.renderSlot(e.$slots,"prepend")]),append:r.withCtx(()=>[r.renderSlot(e.$slots,"append")]),default:r.withCtx(()=>[e.disabled?(r.openBlock(!0),r.createElementBlock(r.Fragment,{key:0},r.renderList(e.items,(c,v)=>r.renderSlot(e.$slots,"default",{key:e.getItemKey(c,v),item:c,index:v})),128)):(r.openBlock(!0),r.createElementBlock(r.Fragment,{key:1},r.renderList(e.visibleItemsInfo,({item:c,index:v})=>r.renderSlot(e.$slots,"default",{key:e.getItemKey(c,v),item:c,index:v})),128))]),_:3},8,["style","table"])],36)}const le=j(ne,[["render",re]]);module.exports=le;

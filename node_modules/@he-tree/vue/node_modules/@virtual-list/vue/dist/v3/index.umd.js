(function(l,k){typeof exports=="object"&&typeof module<"u"?module.exports=k(require("vue-demi"),require("helper-js"),require("vue")):typeof define=="function"&&define.amd?define(["vue-demi","helper-js","vue"],k):(l=typeof globalThis<"u"?globalThis:l||self,l.virtualListVue=k(l.VueDemi,l.hp,l.Vue))})(this,function(l,k,r){"use strict";/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */function q(e){const s=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const a in e)if(a!=="default"){const c=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(s,a,c.get?c:{enumerable:!0,get:()=>e[a]})}}return s.default=e,Object.freeze(s)}const m=q(k),A=l.defineComponent({props:{table:Boolean}}),R=(e,s)=>{const a=e.__vccOpts||e;for(const[c,y]of s)a[c]=y;return a},M={key:0},H={key:1};function G(e,s,a,c,y,$){return e.table?(r.openBlock(),r.createElementBlock("table",M,[r.renderSlot(e.$slots,"prepend"),r.createElementVNode("tbody",null,[r.renderSlot(e.$slots,"default")]),r.renderSlot(e.$slots,"append")])):(r.openBlock(),r.createElementBlock("div",H,[r.renderSlot(e.$slots,"prepend"),r.renderSlot(e.$slots,"default"),r.renderSlot(e.$slots,"append")]))}const _=R(A,[["render",G]]),J=l.defineComponent({components:{VirtualListTable:_},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const s=l.ref(0),a=l.ref(e.firstRender-1),c=l.computed(()=>{var t;return m.notGreaterThan(a.value,(((t=e.items)==null?void 0:t.length)||1)-1)}),y=l.ref(0),$=l.computed(()=>b.value[s.value]?N(s.value):0),I=l.computed(()=>b.value.length>0?N(b.value.length-1)+m.arrayLast(T.value):0),d=l.computed(()=>b.value[c.value]?I.value-N(c.value)-T.value[c.value]:0),h=l.computed(()=>e.disabled?{}:{overflow:"auto"}),U=l.computed(()=>{const t={display:"flex"};return e.disabled||(e.horizontal?Object.assign(t,{"margin-left":$.value+"px","margin-right":d.value+"px",width:I.value-d.value-$.value+"px"}):Object.assign(t,{"margin-top":$.value+"px","margin-bottom":d.value+"px"})),t["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete t.display,delete t["flex-direction"]),t}),F=l.computed(()=>l.reactive((e.items||[]).map(()=>null))),T=l.computed(()=>(e.items||[]).map((t,n)=>{var g;if(F[n]!=null)return F[n];let o=(g=e.itemSize)==null?void 0:g.call(e,t,n);return o==null&&(o=y.value),o})),b=l.computed(()=>{const t=[];return T.value.reduce((n,o)=>(t.push(n),n+o),0),t});l.watch(()=>e.items,p);const X=l.computed(()=>{if(!e.items||e.disabled)return;const t=[];for(let n=s.value;n<=c.value;n++){const o=e.items[n];if(!o)break;t.push({item:o,index:n})}return t}),v=l.ref(),j=l.ref();l.onMounted(async()=>{p();try{Z()}catch{await l.nextTick(),p()}});let C;function Y(){const t=v.value;if(!t)return;const n=E(t);C!=null&&e.buffer-Math.abs(n-C)>=10||(C=n,p())}let L=!1,O=!1;async function p(){var W;if(L){O=!0;return}if(!e.items||e.disabled)return;L=!0;const t=v.value,n=(W=j.value)==null?void 0:W.$el;if(!t||!n)return;y.value||(y.value=ne()),s.value=ee(),a.value=te(),await l.nextTick();let o,g=0;const B={},P=e.table?n.querySelector("tbody").children:n.children;for(let u=0;u<P.length;u++){const i=P[u],f=m.css(i,"position");if(f&&["absolute","fixed"].includes(f))continue;const S=m.css(i,"display")!=="none"?x(i):0,z=i.getAttribute("vt-index"),w=z?parseInt(z):s.value+g;B[w]=(B[w]||0)+S,g++}for(const u of Object.keys(B)){const i=parseInt(u);F.value[i]!==B[i]&&(F.value[i]=B[i],o=!0)}o&&await l.nextTick(),L=!1,O&&(O=!1,p());function ee(){const u=E(t)-K(t)-e.buffer;return m.binarySearch(b.value,f=>f-u,{returnNearestIfNoHit:!0}).index}function te(){const u=E(t)-K(t)+V(t)+e.buffer;return m.binarySearch(b.value,f=>f-u,{returnNearestIfNoHit:!0}).index}function ne(){const i=[],f=e.table?n.querySelector("tbody").children:n.children;for(let S=0;S<f.length;S++){const z=f[S],w=getComputedStyle(z);if(["absolute","fixed"].includes(w.position))continue;const re=x(z);if(i.push(re),i.length>=10)break}return i.length===0?0:i.reduce((S,z)=>S+z,0)/i.length}}function V(t){const n=getComputedStyle(t);let o=parseFloat(e.horizontal?n.width:n.height);return n.boxSizing==="border-box"&&(e.horizontal?o=o-parseFloat(n.borderLeftWidth)-parseFloat(n.borderRightWidth):o=o-parseFloat(n.borderTopWidth)-parseFloat(n.borderBottomWidth)),o}function x(t){let n=V(t);const o=getComputedStyle(t);return e.horizontal?n+=parseFloat(o.borderLeftWidth)+parseFloat(o.borderRightWidth)+parseFloat(o.marginLeft)+parseFloat(o.marginRight):n+=parseFloat(o.borderTopWidth)+parseFloat(o.borderBottomWidth)+parseFloat(o.marginTop)+parseFloat(o.marginBottom),n=Number.isNaN(n)?0:n,n}function E(t){return e.horizontal?t.scrollLeft:t.scrollTop}function K(t){const n=getComputedStyle(t);return e.horizontal?parseFloat(n.paddingLeft):parseFloat(n.paddingTop)}function N(t){return b.value[t]}function Z(){const t=v.value;new ResizeObserver(o=>{for(let g of o)if(m.hasClass(g.target,"vtlist")){p();break}}).observe(t)}function D(t,n){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return n;if(typeof e.itemKey=="function")return e.itemKey(t,n)}}return{listElRef:v,listInnerRef:j,onscroll:Y,listStyle:h,listInnerStyle:U,visibleItemsInfo:X,getItemKey:D,update:p,sizes:T,positions:b,runtimeSizes:F}}});function Q(e,s,a,c,y,$){const I=r.resolveComponent("VirtualListTable");return r.openBlock(),r.createElementBlock("div",{class:"vtlist",ref:"listElRef",style:r.normalizeStyle(e.listStyle),onScrollPassive:s[0]||(s[0]=(...d)=>e.onscroll&&e.onscroll(...d))},[r.createVNode(I,{class:"vtlist-inner",ref:"listInnerRef",style:r.normalizeStyle(e.listInnerStyle),table:e.table},{prepend:r.withCtx(()=>[r.renderSlot(e.$slots,"prepend")]),append:r.withCtx(()=>[r.renderSlot(e.$slots,"append")]),default:r.withCtx(()=>[e.disabled?(r.openBlock(!0),r.createElementBlock(r.Fragment,{key:0},r.renderList(e.items,(d,h)=>r.renderSlot(e.$slots,"default",{key:e.getItemKey(d,h),item:d,index:h})),128)):(r.openBlock(!0),r.createElementBlock(r.Fragment,{key:1},r.renderList(e.visibleItemsInfo,({item:d,index:h})=>r.renderSlot(e.$slots,"default",{key:e.getItemKey(d,h),item:d,index:h})),128))]),_:3},8,["style","table"])],36)}return R(J,[["render",Q]])});

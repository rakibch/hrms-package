(function(r,F){typeof exports=="object"&&typeof module<"u"?module.exports=F(require("vue-demi"),require("helper-js")):typeof define=="function"&&define.amd?define(["vue-demi","helper-js"],F):(r=typeof globalThis<"u"?globalThis:r||self,r.virtualListVue=F(r.VueDemi,r.hp))})(this,function(r,F){"use strict";/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */function A(e){const o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const a in e)if(a!=="default"){const s=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(o,a,s.get?s:{enumerable:!0,get:()=>e[a]})}}return o.default=e,Object.freeze(o)}const h=A(F),H=r.defineComponent({props:{table:Boolean}});var G=function(){var e=this,o=e.$createElement,a=e._self._c||o;return e.table?a("table",[e._t("prepend"),a("tbody",[e._t("default")],2),e._t("append")],2):a("div",[e._t("prepend"),e._t("default"),e._t("append")],2)},J=[];function W(e,o,a,s,c,z,R,T){var u=typeof e=="function"?e.options:e;o&&(u.render=o,u.staticRenderFns=a,u._compiled=!0);var b;if(c&&(b=c),b)if(u.functional){u._injectStyles=b;var v=u.render;u.render=function(j,p){return b.call(p),v(j,p)}}else{var y=u.beforeCreate;u.beforeCreate=y?[].concat(y,b):[b]}return{exports:e,options:u}}const $={};var Q=W(H,G,J,!1,U);function U(e){for(let o in $)this[o]=$[o]}const X=function(){return Q.exports}(),Y=r.defineComponent({components:{VirtualListTable:X},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const o=r.ref(0),a=r.ref(e.firstRender-1),s=r.computed(()=>{var t;return h.notGreaterThan(a.value,(((t=e.items)==null?void 0:t.length)||1)-1)}),c=r.ref(0),z=r.computed(()=>d.value[o.value]?N(o.value):0),R=r.computed(()=>d.value.length>0?N(d.value.length-1)+h.arrayLast(y.value):0),T=r.computed(()=>d.value[s.value]?R.value-N(s.value)-y.value[s.value]:0),u=r.computed(()=>e.disabled?{}:{overflow:"auto"}),b=r.computed(()=>{const t={display:"flex"};return e.disabled||(e.horizontal?Object.assign(t,{"margin-left":z.value+"px","margin-right":T.value+"px",width:R.value-T.value-z.value+"px"}):Object.assign(t,{"margin-top":z.value+"px","margin-bottom":T.value+"px"})),t["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete t.display,delete t["flex-direction"]),t}),v=r.computed(()=>r.reactive((e.items||[]).map(()=>null))),y=r.computed(()=>(e.items||[]).map((t,n)=>{var _;if(v[n]!=null)return v[n];let i=(_=e.itemSize)==null?void 0:_.call(e,t,n);return i==null&&(i=c.value),i})),d=r.computed(()=>{const t=[];return y.value.reduce((n,i)=>(t.push(n),n+i),0),t});r.watch(()=>e.items,g);const j=r.computed(()=>{if(!e.items||e.disabled)return;const t=[];for(let n=o.value;n<=s.value;n++){const i=e.items[n];if(!i)break;t.push({item:i,index:n})}return t}),p=r.ref(),K=r.ref();r.onMounted(async()=>{g();try{re()}catch{await r.nextTick(),g()}});let O;function ne(){const t=p.value;if(!t)return;const n=L(t);O!=null&&e.buffer-Math.abs(n-O)>=10||(O=n,g())}let w=!1,k=!1;async function g(){var q;if(w){k=!0;return}if(!e.items||e.disabled)return;w=!0;const t=p.value,n=(q=K.value)==null?void 0:q.$el;if(!t||!n)return;c.value||(c.value=ae()),o.value=oe(),a.value=le(),await r.nextTick();let i,_=0;const I={},E=e.table?n.querySelector("tbody").children:n.children;for(let f=0;f<E.length;f++){const l=E[f],m=h.css(l,"position");if(m&&["absolute","fixed"].includes(m))continue;const S=h.css(l,"display")!=="none"?M(l):0,x=l.getAttribute("vt-index"),C=x?parseInt(x):o.value+_;I[C]=(I[C]||0)+S,_++}for(const f of Object.keys(I)){const l=parseInt(f);v.value[l]!==I[l]&&(v.value[l]=I[l],i=!0)}i&&await r.nextTick(),w=!1,k&&(k=!1,g());function oe(){const f=L(t)-V(t)-e.buffer;return h.binarySearch(d.value,m=>m-f,{returnNearestIfNoHit:!0}).index}function le(){const f=L(t)-V(t)+P(t)+e.buffer;return h.binarySearch(d.value,m=>m-f,{returnNearestIfNoHit:!0}).index}function ae(){const l=[],m=e.table?n.querySelector("tbody").children:n.children;for(let S=0;S<m.length;S++){const x=m[S],C=getComputedStyle(x);if(["absolute","fixed"].includes(C.position))continue;const se=M(x);if(l.push(se),l.length>=10)break}return l.length===0?0:l.reduce((S,x)=>S+x,0)/l.length}}function P(t){const n=getComputedStyle(t);let i=parseFloat(e.horizontal?n.width:n.height);return n.boxSizing==="border-box"&&(e.horizontal?i=i-parseFloat(n.borderLeftWidth)-parseFloat(n.borderRightWidth):i=i-parseFloat(n.borderTopWidth)-parseFloat(n.borderBottomWidth)),i}function M(t){let n=P(t);const i=getComputedStyle(t);return e.horizontal?n+=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth)+parseFloat(i.marginLeft)+parseFloat(i.marginRight):n+=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth)+parseFloat(i.marginTop)+parseFloat(i.marginBottom),n=Number.isNaN(n)?0:n,n}function L(t){return e.horizontal?t.scrollLeft:t.scrollTop}function V(t){const n=getComputedStyle(t);return e.horizontal?parseFloat(n.paddingLeft):parseFloat(n.paddingTop)}function N(t){return d.value[t]}function re(){const t=p.value;new ResizeObserver(i=>{for(let _ of i)if(h.hasClass(_.target,"vtlist")){g();break}}).observe(t)}function ie(t,n){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return n;if(typeof e.itemKey=="function")return e.itemKey(t,n)}}return{listElRef:p,listInnerRef:K,onscroll:ne,listStyle:u,listInnerStyle:b,visibleItemsInfo:j,getItemKey:ie,update:g,sizes:y,positions:d,runtimeSizes:v}}});var Z=function(){var e=this,o=e.$createElement,a=e._self._c||o;return a("div",{ref:"listElRef",staticClass:"vtlist",style:e.listStyle,on:{"&scroll":function(s){return e.onscroll.apply(null,arguments)}}},[a("VirtualListTable",{ref:"listInnerRef",staticClass:"vtlist-inner",style:e.listInnerStyle,attrs:{table:e.table},scopedSlots:e._u([{key:"prepend",fn:function(){return[e._t("prepend")]},proxy:!0},{key:"append",fn:function(){return[e._t("append")]},proxy:!0}],null,!0)},[e.disabled?[e._l(e.items,function(s,c){return[e._t("default",null,{item:s,index:c})]})]:[e._l(e.visibleItemsInfo,function(s){var c=s.item,z=s.index;return[e._t("default",null,{item:c,index:z})]})]],2)],1)},D=[];const B={};var ee=W(Y,Z,D,!1,te);function te(e){for(let o in B)this[o]=B[o]}return function(){return ee.exports}()});

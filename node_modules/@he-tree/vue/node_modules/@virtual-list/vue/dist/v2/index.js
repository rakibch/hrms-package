"use strict";/*!
 * @virtual-list/vue
 * Author: phphe <phphe@outlook.com> (https://github.com/phphe)
 * Homepage: https://virtual-list.phphe.com
 * Released under the MIT License.
 */const i=require("vue-demi"),U=require("helper-js");function X(e){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const a in e)if(a!=="default"){const s=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(l,a,s.get?s:{enumerable:!0,get:()=>e[a]})}}return l.default=e,Object.freeze(l)}const x=X(U),Y=i.defineComponent({props:{table:Boolean}});var Z=function(){var e=this,l=e.$createElement,a=e._self._c||l;return e.table?a("table",[e._t("prepend"),a("tbody",[e._t("default")],2),e._t("append")],2):a("div",[e._t("prepend"),e._t("default"),e._t("append")],2)},ee=[];function q(e,l,a,s,c,z,R,I){var u=typeof e=="function"?e.options:e;l&&(u.render=l,u.staticRenderFns=a,u._compiled=!0);var v;if(c&&(v=c),v)if(u.functional){u._injectStyles=v;var b=u.render;u.render=function(T,y){return v.call(y),b(T,y)}}else{var h=u.beforeCreate;u.beforeCreate=h?[].concat(h,v):[v]}return{exports:e,options:u}}const M={};var te=q(Y,Z,ee,!1,ne);function ne(e){for(let l in M)this[l]=M[l]}const re=function(){return te.exports}(),ie=i.defineComponent({components:{VirtualListTable:re},props:{items:Array,disabled:Boolean,horizontal:Boolean,firstRender:{type:Number,default:10},buffer:{type:Number,default:100},itemKey:{type:[String,Function]},itemSize:{type:Function},table:Boolean},setup(e){const l=i.ref(0),a=i.ref(e.firstRender-1),s=i.computed(()=>{var t;return x.notGreaterThan(a.value,(((t=e.items)==null?void 0:t.length)||1)-1)}),c=i.ref(0),z=i.computed(()=>d.value[l.value]?N(l.value):0),R=i.computed(()=>d.value.length>0?N(d.value.length-1)+x.arrayLast(h.value):0),I=i.computed(()=>d.value[s.value]?R.value-N(s.value)-h.value[s.value]:0),u=i.computed(()=>e.disabled?{}:{overflow:"auto"}),v=i.computed(()=>{const t={display:"flex"};return e.disabled||(e.horizontal?Object.assign(t,{"margin-left":z.value+"px","margin-right":I.value+"px",width:R.value-I.value-z.value+"px"}):Object.assign(t,{"margin-top":z.value+"px","margin-bottom":I.value+"px"})),t["flex-direction"]=e.horizontal?"row":"column",e.table&&(delete t.display,delete t["flex-direction"]),t}),b=i.computed(()=>i.reactive((e.items||[]).map(()=>null))),h=i.computed(()=>(e.items||[]).map((t,n)=>{var _;if(b[n]!=null)return b[n];let r=(_=e.itemSize)==null?void 0:_.call(e,t,n);return r==null&&(r=c.value),r})),d=i.computed(()=>{const t=[];return h.value.reduce((n,r)=>(t.push(n),n+r),0),t});i.watch(()=>e.items,g);const T=i.computed(()=>{if(!e.items||e.disabled)return;const t=[];for(let n=l.value;n<=s.value;n++){const r=e.items[n];if(!r)break;t.push({item:r,index:n})}return t}),y=i.ref(),L=i.ref();i.onMounted(async()=>{g();try{D()}catch{await i.nextTick(),g()}});let O;function A(){const t=y.value;if(!t)return;const n=j(t);O!=null&&e.buffer-Math.abs(n-O)>=10||(O=n,g())}let w=!1,k=!1;async function g(){var P;if(w){k=!0;return}if(!e.items||e.disabled)return;w=!0;const t=y.value,n=(P=L.value)==null?void 0:P.$el;if(!t||!n)return;c.value||(c.value=J()),l.value=H(),a.value=G(),await i.nextTick();let r,_=0;const F={},K=e.table?n.querySelector("tbody").children:n.children;for(let f=0;f<K.length;f++){const o=K[f],m=x.css(o,"position");if(m&&["absolute","fixed"].includes(m))continue;const p=x.css(o,"display")!=="none"?$(o):0,S=o.getAttribute("vt-index"),C=S?parseInt(S):l.value+_;F[C]=(F[C]||0)+p,_++}for(const f of Object.keys(F)){const o=parseInt(f);b.value[o]!==F[o]&&(b.value[o]=F[o],r=!0)}r&&await i.nextTick(),w=!1,k&&(k=!1,g());function H(){const f=j(t)-B(t)-e.buffer;return x.binarySearch(d.value,m=>m-f,{returnNearestIfNoHit:!0}).index}function G(){const f=j(t)-B(t)+W(t)+e.buffer;return x.binarySearch(d.value,m=>m-f,{returnNearestIfNoHit:!0}).index}function J(){const o=[],m=e.table?n.querySelector("tbody").children:n.children;for(let p=0;p<m.length;p++){const S=m[p],C=getComputedStyle(S);if(["absolute","fixed"].includes(C.position))continue;const Q=$(S);if(o.push(Q),o.length>=10)break}return o.length===0?0:o.reduce((p,S)=>p+S,0)/o.length}}function W(t){const n=getComputedStyle(t);let r=parseFloat(e.horizontal?n.width:n.height);return n.boxSizing==="border-box"&&(e.horizontal?r=r-parseFloat(n.borderLeftWidth)-parseFloat(n.borderRightWidth):r=r-parseFloat(n.borderTopWidth)-parseFloat(n.borderBottomWidth)),r}function $(t){let n=W(t);const r=getComputedStyle(t);return e.horizontal?n+=parseFloat(r.borderLeftWidth)+parseFloat(r.borderRightWidth)+parseFloat(r.marginLeft)+parseFloat(r.marginRight):n+=parseFloat(r.borderTopWidth)+parseFloat(r.borderBottomWidth)+parseFloat(r.marginTop)+parseFloat(r.marginBottom),n=Number.isNaN(n)?0:n,n}function j(t){return e.horizontal?t.scrollLeft:t.scrollTop}function B(t){const n=getComputedStyle(t);return e.horizontal?parseFloat(n.paddingLeft):parseFloat(n.paddingTop)}function N(t){return d.value[t]}function D(){const t=y.value;new ResizeObserver(r=>{for(let _ of r)if(x.hasClass(_.target,"vtlist")){g();break}}).observe(t)}function V(t,n){if(e.itemKey){if(typeof e.itemKey=="string"&&e.itemKey==="index")return n;if(typeof e.itemKey=="function")return e.itemKey(t,n)}}return{listElRef:y,listInnerRef:L,onscroll:A,listStyle:u,listInnerStyle:v,visibleItemsInfo:T,getItemKey:V,update:g,sizes:h,positions:d,runtimeSizes:b}}});var le=function(){var e=this,l=e.$createElement,a=e._self._c||l;return a("div",{ref:"listElRef",staticClass:"vtlist",style:e.listStyle,on:{"&scroll":function(s){return e.onscroll.apply(null,arguments)}}},[a("VirtualListTable",{ref:"listInnerRef",staticClass:"vtlist-inner",style:e.listInnerStyle,attrs:{table:e.table},scopedSlots:e._u([{key:"prepend",fn:function(){return[e._t("prepend")]},proxy:!0},{key:"append",fn:function(){return[e._t("append")]},proxy:!0}],null,!0)},[e.disabled?[e._l(e.items,function(s,c){return[e._t("default",null,{item:s,index:c})]})]:[e._l(e.visibleItemsInfo,function(s){var c=s.item,z=s.index;return[e._t("default",null,{item:c,index:z})]})]],2)],1)},oe=[];const E={};var ae=q(ie,le,oe,!1,se);function se(e){for(let l in E)this[l]=E[l]}const ue=function(){return ae.exports}();module.exports=ue;
